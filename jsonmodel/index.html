<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>jsonModel Class - Json Model</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Json Model</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">jsonModel Class</a>
                            </li>
                            <li class="navitem">
                                <a href="../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="navitem">
                                <a href="../extensions/" class="nav-link">Extensions</a>
                            </li>
                            <li class="navitem">
                                <a href="../roadmap/" class="nav-link">Roadmap</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../reference/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#jsonmodel-class" class="nav-link">jsonModel Class</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#declare-schema" class="nav-link">Declare Schema</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#import-schema" class="nav-link">Import Schema</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#initialize-model" class="nav-link">Initialize Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#validate-input" class="nav-link">Validate Input</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#handle-errors" class="nav-link">Handle Errors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ingest-kwargs" class="nav-link">Ingest Kwargs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#query-records" class="nav-link">Query Records</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="jsonmodel-class">jsonModel Class</h1>
<p>The jsonModel class is the main class of the module. A jsonModel object must be initialized with a json-valid dictionary with the schema you wish to valid. When the object is initialized, it validates the architecture of the model declaration itself to facilitate the model design process and ensure that no models break the rules of the module. Once a valid model is constructed, input can then be fed to the class method &lsquo;validate&rsquo; to determine whether the input is valid. Error reports are provided to identify the scope of conditionals applicable to any given property in addition to the module documentation.</p>
<h2 id="declare-schema">Declare Schema</h2>
<p>Save in sample-schema.json::</p>
<pre><code>{
    "schema": {
        "property": "value"
    },
    "components": {},
    "title": "my cool data model",
    "description": "model for performance analytics records of my sweet app",
    "metadata": { "version": "1.1.1" },
    "url": "https://collectiveacuity.com/api/mycoolresource?jsonmodel=true",
    "max_size": 1024,
}
</code></pre>
<p><em>[all fields except schema are optional]</em></p>
<h2 id="import-schema">Import Schema</h2>
<p>To import the schema::</p>
<pre><code>import json

sample_schema = json.loads(open('sample-schema.json').read())
</code></pre>
<h2 id="initialize-model">Initialize Model</h2>
<p>To initialize the class object::</p>
<pre><code>from jsonmodel.validators import jsonModel

valid_model = jsonModel(sample_schema)
</code></pre>
<h2 id="validate-input">Validate Input</h2>
<p>To validate input against model declaration::</p>
<pre><code>valid_model.validate(input)
</code></pre>
<p>To validate input against an individual component::</p>
<pre><code>path_to_root = '.property'
valid_model.validate(input, path_to_root)
</code></pre>
<h2 id="handle-errors">Handle Errors</h2>
<p>To handle invalid inputs::</p>
<pre><code>try:
    valid_model.validate(invalid_input)
except InputValidationError as err:
    assert err.error['error_code'] &gt; 4000
</code></pre>
<p>To customize error message:</p>
<pre><code>input_title = 'Property field in input'
valid_model.validate(input, path_to_root, input_title)
</code></pre>
<h2 id="ingest-kwargs">Ingest Kwargs</h2>
<p>This module also supports the ingestion of keyword arguments. The process of ingestion recursively walks the valid model searching for key-value pairs which match the keyword arguments of the input. For each match it finds, it constructs a key-value pair in the dictionary using the following rules (in order):</p>
<ol>
<li>Value in kwargs if field passes all its component validation tests</li>
<li>Default value declared for the key in the model</li>
<li>Empty value appropriate to datatype of key in the model</li>
</ol>
<p>As a result, ingestion will produce an output which contains all the keys declared in the model. If there is a <strong>default value</strong> declared for each key in the model, it is also guaranteed to return a dictionary that will pass a model validation test. Extra keyword arguments are ignored unless extra fields is <em>True</em> in the model declaration.</p>
<p>To ingest kwargs::</p>
<pre><code>output_dict = valid_model.ingest(**kwargs)
</code></pre>
<p>To produce a default record:</p>
<pre><code>default_dict = valid_model.ingest()
</code></pre>
<h3 id="use-declared">Use Declared</h3>
<p>Another way to guarantee an ingestion will return a dictionary that will pass a model validation test is by using the <code>use_declared</code> method before ingestion. <code>use_declared</code> will automatically assign the declared value to any key in the schema without a &ldquo;default_value&rdquo; qualifier.</p>
<p>To produce a default record with declared values instead:</p>
<pre><code>valid_model.use_declared()
declared_dict = valid_model.ingest()
</code></pre>
<h2 id="query-records">Query Records</h2>
<p>The jsonModel class also supports record querying on model validated data. When the model is initialized, it constructs a set of operators that can be used to query records which contain data validated by the model. The set of valid operators and qualifiers which can be used to query records on each field depend upon its datatype. The query criteria for each field is the subset of the criteria that can be declared for that field in the components section of the model which can evaluate to &lsquo;true&rsquo; against a value stored for that field in a record.</p>
<p>The built in query method supports any number of fields declared in the model as well as the maximum subset of query relevant criteria for each field based upon its datatype. But the model can also be initialized with a customized dictionary of rules for field datatypes based upon what is supported by a specific query engine.  In this way, the query method can be used as a bridge across multiple different database query languages (with a jsonModel valid record access object customized for applicable databases) or as a post-request filter for records stored in a way that does not support robust query criteria.</p>
<p>To declare query rules::</p>
<pre><code>{
    ".string_fields": {
        "must_contain": []
    }
}
</code></pre>
<p>To initialize model with custom query rules::</p>
<pre><code>query_rules = json.loads(open('query-rules.json').read())

valid_model = jsonModel(sample_model, query_rules)
</code></pre>
<p>To declare query criteria::</p>
<pre><code>{
    'dot.path[2].field': {
        'must_contain': [ 'v.+' ]
    }
}
</code></pre>
<p>To validate query criteria::</p>
<pre><code>valid_model.query(sample_query)
</code></pre>
<p>To evaluate a record using the criteria::</p>
<pre><code>valid_input = valid_model.validate(input)

eval_outcome = valid_model.query(sample_query, valid_input)
assert isinstance(eval_outcome, bool)
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
